/*
 * viewport - jQuery plugin for elements positioning in viewport
 * (c) Copyright 2014, Anton Zinoviev aka xobotyi
 * Released under the MIT license
 */
 (function(b){var a={getElementPosition:function(){var c=b(this).parents(":have-scroll");if(!c.length){return false}var d=a.getFromTop.call(this)-c.scrollTop();var e=a.getFromLeft.call(this)-c.scrollLeft();return{elemTopBorder:d,elemBottomBorder:d+b(this).height(),elemLeftBorder:e,elemRightBorder:e+b(this).width(),viewport:c,viewportHeight:c.height(),viewportWidth:c.width()}},getFromTop:function(){var c=0;for(var d=b(this).get(0);d&&!b(d).is(":have-scroll");d=d.offsetParent){c+=d.offsetTop}return Math.round(c)},getFromLeft:function(){var d=0;for(var c=b(this).get(0);c&&!b(c).is(":have-scroll");c=c.offsetParent){d+=c.offsetLeft}return Math.round(d)},aboveTheViewport:function(d){var c=typeof d=="string"?parseInt(d,10):0;var e=a.getElementPosition.call(this);return e?e.elemTopBorder-c<0:false},partlyAboveTheViewport:function(d){var c=typeof d=="string"?parseInt(d,10):0;var e=a.getElementPosition.call(this);return e?e.elemTopBorder-c<0&&e.elemBottomBorder-c>=0:false},belowTheViewport:function(d){var c=typeof d=="string"?parseInt(d,10):0;var e=a.getElementPosition.call(this);return e?e.viewportHeight<=e.elemBottomBorder+c:false},partlyBelowTheViewport:function(d){var c=typeof d=="string"?parseInt(d,10):0;var e=a.getElementPosition.call(this);return e?e.viewportHeight<=e.elemBottomBorder+c&&e.viewportHeight>e.elemTopBorder-c:false},leftOfViewport:function(d){var c=typeof d=="string"?parseInt(d,10):0;var e=a.getElementPosition.call(this);return e?e.elemLeftBorder-c<0:false},partlyLeftOfViewport:function(d){var c=typeof d=="string"?parseInt(d,10):0;var e=a.getElementPosition.call(this);return e?e.elemLeftBorder-c<0&&e.elemRightBorder+c>=0:false},rightOfViewport:function(d){var c=typeof d=="string"?parseInt(d,10):0;var e=a.getElementPosition.call(this);return e?e.viewportWidth<=e.elemRightBorder+c:false},partlyRightOfViewport:function(d){var c=typeof d=="string"?parseInt(d,10):0;var e=a.getElementPosition.call(this);return e?e.viewportWidth<=e.elemRightBorder+c&&e.viewportWidth>e.elemLeftBorder-c:false},inViewport:function(c){return !a.aboveTheViewport.call(this,c)&&!a.belowTheViewport.call(this,c)&&!a.leftOfViewport.call(this,c)&&!a.rightOfViewport.call(this,c)},getState:function(m){var e=b.extend({threshold:0,allowPartly:false,allowMixedStates:false},m);var j=a.aboveTheViewport.call(this,e.threshold);var l=a.belowTheViewport.call(this,e.threshold);var k=a.leftOfViewport.call(this,e.threshold);var c=a.rightOfViewport.call(this,e.threshold);var d="";if(!j&&!l&&!k&&!c){d="inside"}else{if(e.allowPartly){var f=a.partlyAboveTheViewport.call(this,e.threshold);var g=a.partlyBelowTheViewport.call(this,e.threshold);var i=a.partlyLeftOfViewport.call(this,e.threshold);var h=a.partlyRightOfViewport.call(this,e.threshold);if(f&&!g){if(e.allowMixedStates&&(i||h)){d=i?"partly-above partly-left":"partly-above partly-right"}else{if(e.allowMixedStates&&(k||c)){d=k?"left partly-above":"right partly-above"}else{d="partly-above"}}}else{if(g&&!f){if(e.allowMixedStates&&(i||h)){d=i?"partly-below partly-left":"partly-below partly-right"}else{if(e.allowMixedStates&&(k||c)){d=k?"left partly-below":"right partly-below"}else{d="partly-below"}}}else{if(i&&!f&&!g&&!h){if(e.allowMixedStates&&(j||l)){d=j?"above partly-left":"below partly-left"}else{d="partly-left"}}else{if(h&&!f&&!g&&!i){if(e.allowMixedStates&&(j||l)){d=j?"above partly-right":"below partly-right"}else{d="partly-right"}}}}}}if(d==""){if(j&&!l){if(e.allowMixedStates&&(k||c)){d=k?"above-left":"above-right"}else{d="above"}}else{if(l&&!j){if(e.allowMixedStates&&(k||c)){d=k?"below-left":"below-right"}else{d="below"}}else{if(k&&!j&&!l&&!c){d="left"}else{if(c&&!j&&!l&&!k){d="right"}else{d="outside"}}}}}}return d},haveScroll:function(){return this.scrollHeight>this.offsetHeight||this.scrollWidth>this.offsetWidth},generateEUID:function(){var c="";for(var d=0;d<32;d++){c+=Math.floor(Math.random()*16).toString(16)}return c}};b.extend(b.expr[":"],{"in-viewport":function(e,c,d){return a.inViewport.call(e,d[3])},"above-the-viewport":function(e,c,d){return a.aboveTheViewport.call(e,d[3])},"below-the-viewport":function(e,c,d){return a.belowTheViewport.call(e,d[3])},"left-of-viewport":function(e,c,d){return a.leftOfViewport.call(e,d[3])},"right-of-viewport":function(e,c,d){return a.rightOfViewport.call(e,d[3])},"partly-above-the-viewport":function(e,c,d){return a.partlyAboveTheViewport.call(e,d[3])},"partly-below-the-viewport":function(e,c,d){return a.partlyBelowTheViewport.call(e,d[3])},"partly-left-of-viewport":function(e,c,d){return a.partlyLeftOfViewport.call(e,d[3])},"partly-right-of-viewport":function(e,c,d){return a.partlyRightOfViewport.call(e,d[3])},"have-scroll":function(c){return a.haveScroll.call(c)}});b.fn.viewportTrack=function(e,c){var d=b.extend({threshold:0,allowPartly:false,allowMixedStates:false},c);if(typeof e=="string"&&e=="destroy"){return this.each(function(){var g=this;var f=b(g).parent(":have-scroll");if(f.get(0).tagName=="BODY"){b(window).unbind(".viewport"+b(this).data("euid"));b(this).removeData("euid")}else{f.unbind(".viewport"+b(this).data("euid"));b(this).removeData("euid")}})}else{if(typeof e!="function"){b.error("Callback function not defined");return this}}return this.each(function(){var g=this;b(this).data("euid",a.generateEUID.call());e.apply(g,[a.getState.apply(g,[d])]);var f=b(g).parents(":have-scroll");if(!f.length){return false}if(f.get(0).tagName=="BODY"){b(window).bind("scroll.viewport"+b(this).data("euid"),function(){e.apply(g,[a.getState.apply(g,[d])])})}else{f.bind("scroll.viewport"+b(this).data("euid"),function(){e.apply(g,[a.getState.apply(g,[d])])})}})}})(jQuery);