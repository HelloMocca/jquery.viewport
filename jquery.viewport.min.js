(function(b){var a={getElementPosition:function(){var d=b(this);var c=d.parents(":have-scroll");if(!c.length){return false}var g=a.getRelativePosition.call(this);var e=g.top-c.scrollTop();var f=g.left-c.scrollLeft();return{elemTopBorder:e,elemBottomBorder:e+d.height(),elemLeftBorder:f,elemRightBorder:f+d.width(),viewport:c,viewportHeight:c.height(),viewportWidth:c.width()}},getRelativePosition:function(){var c=0;var e=0;for(var d=b(this).get(0);d&&!b(d).is(":have-scroll");d=d.offsetParent){c+=d.offsetTop;e+=d.offsetLeft}return{top:Math.round(c),left:Math.round(e)}},aboveTheViewport:function(d){var c=typeof d=="string"?parseInt(d,10):0;var e=a.getElementPosition.call(this);return e?e.elemTopBorder-c<0:false},partlyAboveTheViewport:function(d){var c=typeof d=="string"?parseInt(d,10):0;var e=a.getElementPosition.call(this);return e?e.elemTopBorder-c<0&&e.elemBottomBorder-c>=0:false},belowTheViewport:function(d){var c=typeof d=="string"?parseInt(d,10):0;var e=a.getElementPosition.call(this);return e?e.viewportHeight<e.elemBottomBorder+c:false},partlyBelowTheViewport:function(d){var c=typeof d=="string"?parseInt(d,10):0;var e=a.getElementPosition.call(this);return e?e.viewportHeight<e.elemBottomBorder+c&&e.viewportHeight>e.elemTopBorder+c:false},leftOfViewport:function(d){var c=typeof d=="string"?parseInt(d,10):0;var e=a.getElementPosition.call(this);return e?e.elemLeftBorder-c<=0:false},partlyLeftOfViewport:function(d){var c=typeof d=="string"?parseInt(d,10):0;var e=a.getElementPosition.call(this);return e?e.elemLeftBorder-c<0&&e.elemRightBorder-c>=0:false},rightOfViewport:function(d){var c=typeof d=="string"?parseInt(d,10):0;var e=a.getElementPosition.call(this);return e?e.viewportWidth<e.elemRightBorder+c:false},partlyRightOfViewport:function(d){var c=typeof d=="string"?parseInt(d,10):0;var e=a.getElementPosition.call(this);return e?e.viewportWidth<e.elemRightBorder+c&&e.viewportWidth>e.elemLeftBorder+c:false},inViewport:function(d){var c=typeof d=="string"?parseInt(d,10):0;var e=a.getElementPosition.call(this);return e?!(e.elemTopBorder-c<0)&&!(e.viewportHeight<e.elemBottomBorder+c)&&!(e.elemLeftBorder-c<0)&&!(e.viewportWidth<e.elemRightBorder+c):true},getState:function(n){var e=b.extend({threshold:0,allowPartly:false},n);var h={inside:false,posY:"",posX:""};var i=a.getElementPosition.call(this);if(!i){h.inside=true;return h}var k=i.elemTopBorder-e.threshold<0;var m=i.viewportHeight<i.elemBottomBorder+e.threshold;var l=i.elemLeftBorder-e.threshold<0;var c=i.viewportWidth<i.elemRightBorder+e.threshold;if(e.allowPartly){var d=i.elemTopBorder-e.threshold<0&&i.elemBottomBorder-e.threshold>=0;var f=i.viewportHeight<i.elemBottomBorder+e.threshold&&i.viewportHeight>i.elemTopBorder+e.threshold;var j=i.elemLeftBorder-e.threshold<0&&i.elemRightBorder-e.threshold>=0;var g=i.viewportWidth<i.elemRightBorder+e.threshold&&i.viewportWidth>i.elemLeftBorder+e.threshold}if(!k&&!m&&!l&&!c){h.inside=true;return h}if(e.allowPartly){if(d&&f){h.posY="exceeds"}else{if((d&&!f)||(f&&!d)){h.posY=d?"partly-above":"partly-below"}else{if(!k&&!m){h.posY="inside"}else{h.posY=k?"above":"below"}}}if(j&&g){h.posX="exceeds"}else{if((j&&!g)||(j&&!g)){h.posX=j?"partly-above":"partly-below"}else{if(!l&&!c){h.posX="inside"}else{h.posX=l?"left":"right"}}}}else{if(k&&m){h.posY="exceeds"}else{if(!k&&!m){h.posY="inside"}else{h.posY=k?"above":"below"}}if(l&&c){h.posX="exceeds"}else{if(!l&&!c){h.posX="inside"}else{h.posX=l?"left":"right"}}}return h},haveScroll:function(){return this.scrollHeight>this.offsetHeight||this.scrollWidth>this.offsetWidth},generateEUID:function(){var c="";for(var d=0;d<32;d++){c+=Math.floor(Math.random()*16).toString(16)}return c}};b.extend(b.expr[":"],{"in-viewport":function(e,c,d){return a.inViewport.call(e,d[3])},"above-the-viewport":function(e,c,d){return a.aboveTheViewport.call(e,d[3])},"below-the-viewport":function(e,c,d){return a.belowTheViewport.call(e,d[3])},"left-of-viewport":function(e,c,d){return a.leftOfViewport.call(e,d[3])},"right-of-viewport":function(e,c,d){return a.rightOfViewport.call(e,d[3])},"partly-above-the-viewport":function(e,c,d){return a.partlyAboveTheViewport.call(e,d[3])},"partly-below-the-viewport":function(e,c,d){return a.partlyBelowTheViewport.call(e,d[3])},"partly-left-of-viewport":function(e,c,d){return a.partlyLeftOfViewport.call(e,d[3])},"partly-right-of-viewport":function(e,c,d){return a.partlyRightOfViewport.call(e,d[3])},"have-scroll":function(c){return a.haveScroll.call(c)}});b.fn.viewportTrack=function(e,c){var d=b.extend({threshold:0,checkOnInit:true,allowPartly:false},c);if(typeof e=="string"&&e=="destroy"){return this.each(function(){var g=b(this);var f=g.parent(":have-scroll");if(!f.length||typeof g.data("euid")=="undefined"){return true}if(f.get(0).tagName=="BODY"){b(window).unbind(".viewport"+g.data("euid"));g.removeData("euid")}else{f.unbind(".viewport"+g.data("euid"));g.removeData("euid")}})}else{if(typeof e!="function"){b.error("Callback function not defined");return this}}return this.each(function(){var h=b(this);var g=this;if(typeof h.data("euid")=="undefined"){h.data("euid",a.generateEUID.call())}if(d.checkOnInit){e.apply(g,[a.getState.apply(g,[d])])}var f=b(h).parents(":have-scroll");if(!f.length){e.apply(g,[{inside:true,posY:"",posX:""}]);return true}if(f.get(0).tagName=="BODY"){b(window).bind("scroll.viewport"+h.data("euid"),function(){e.apply(g,[a.getState.apply(g,[d])])})}else{f.bind("scroll.viewport"+h.data("euid"),function(){e.apply(g,[a.getState.apply(g,[d])])})}})}})(jQuery);